{% extends "core/base.html" %} {% load static %} {% block title %}Your Profile -
AI4S Platform{% endblock %} {% block extra_css %}
<link rel="stylesheet" href="{% static 'users/css/profile_styles.css' %}" />
{% endblock %} {% block content %}
<div class="profile-page-container">
  <div class="page-header">
    <h1>Account Settings</h1>
    <p>Manage your profile, security, and account preferences.</p>
  </div>

  <div class="profile-grid">
    <!-- Left Column: Avatar and Quick Actions -->
    <aside class="profile-sidebar">
      {% comment %}
      <div class="profile-avatar-wrapper">
        <img
          src="{{ user.profile.avatar.url|default:'/static/core/images/default-avatar.png' }}"
          alt="Your Avatar"
          id="avatarPreview"
        />
        <label for="avatarUpload" class="avatar-upload-label">
          <i class="fas fa-camera"></i>
        </label>
        <input
          type="file"
          id="avatarUpload"
          accept="image/*"
          style="display: none"
        />
      </div>
      {% endcomment %}
      <h2>{{ user.username }}</h2>
      <p>{{ user.email }}</p>
      <form action="{% url 'logout' %}" method="post" style="display: inline">
        {% csrf_token %}
        <button type="submit" class="btn btn-secondary" style="width: 100%">
          <i class="fas fa-sign-out-alt"></i> Logout
        </button>
      </form>
    </aside>

    <!-- Right Column: Main Settings Panels -->
    <main class="profile-main">
      <!-- Profile Information Card -->
      <div class="profile-card">
        <div class="card-header">
          <h3>Profile Information</h3>
          <button id="editProfileBtn" class="btn btn-sm">Edit</button>
          <div id="editActions" style="display: none">
            <button id="cancelEditBtn" class="btn btn-sm btn-secondary">
              Cancel
            </button>
            <button id="saveProfileBtn" class="btn btn-sm btn-primary">
              Save Changes
            </button>
          </div>
        </div>
        <div class="card-body">
          <form id="profileEditForm">
            <div class="form-group">
              <label>Username</label>
              <span id="usernameText">{{ user.username }}</span>
              <input
                type="text"
                id="usernameInput"
                value="{{ user.username }}"
                style="display: none"
                disabled
              />
              <small>Your username cannot be changed.</small>
            </div>
            <div class="form-group">
              <label>Email Address</label>
              <span id="emailText">{{ user.email }}</span>
              <input
                type="email"
                id="emailInput"
                value="{{ user.email }}"
                style="display: none"
              />
            </div>
          </form>
        </div>
      </div>

      <!-- Security Card -->
      <div class="profile-card">
        <div class="card-header"><h3>Security</h3></div>
        <div class="card-body">
          <!-- Password Change Form -->
          <form
            id="passwordChangeForm"
            action="{% url 'users:change_password' %}"
            method="post"
          >
            {% csrf_token %}
            <div class="form-group">
              <label for="current_password">Current Password</label>
              <input
                type="password"
                id="current_password"
                name="current_password"
                placeholder="Current Password"
                required
              />
            </div>
            <div class="form-group" style="margin-top: 10px">
              <label for="new_password1">New Password</label>
              <input
                type="password"
                id="new_password1"
                name="new_password1"
                placeholder="New Password"
                required
              />
            </div>
            <div class="form-group" style="margin-top: 10px">
              <label for="new_password2">Confirm New Password</label>
              <input
                type="password"
                id="new_password2"
                name="new_password2"
                placeholder="Confirm New Password"
                required
              />
            </div>

            <button
              type="submit"
              class="btn btn-primary"
              style="margin-top: 10px; width: 50%"
            >
              Change Password
            </button>
          </form>
          <!-- Optionally, you can display form errors/success messages here -->
        </div>
      </div>

      <!-- Danger Zone Card -->
      <div class="profile-card danger-zone">
        <div class="card-header"><h3>Danger Zone</h3></div>
        <div class="card-body">
          <p>Be careful, these actions are permanent.</p>
          <button id="deleteAccountBtn" class="btn btn-danger">
            Delete My Account
          </button>
        </div>
      </div>

      <!-- Confirmation Modal for Account Deletion -->
      <div id="deleteConfirmModal" class="modal-overlay" style="display: none">
        <div class="modal-content">
          <i class="fas fa-exclamation-triangle modal-icon"></i>
          <h2>Are you sure?</h2>
          <p>
            This action cannot be undone. All of your test history and data will
            be permanently deleted.
          </p>
          <div class="modal-actions">
            <button id="cancelDeleteBtn" class="btn btn-secondary">
              Cancel
            </button>
            <button id="confirmDeleteBtn" class="btn btn-danger">
              Yes, Delete My Account
            </button>
          </div>
        </div>
      </div>

      <!-- Hidden Delete Form (for secure POST) -->
      <form
        id="deleteForm"
        action="{% url 'users:delete_account' %}"
        method="post"
        style="display: none"
      >
        {% csrf_token %}
      </form>
    </main>
  </div>
</div>

<!-- Confirmation Modal for Account Deletion (Duplicate removed) -->

<script src="{% static 'users/js/profile.js' %}"></script>
{% endblock %}
